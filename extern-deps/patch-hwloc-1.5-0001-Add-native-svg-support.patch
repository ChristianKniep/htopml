From 46b818f6ee31bed0dbc43683c97fd4340e2764a4 Mon Sep 17 00:00:00 2001
From: Sebastien Valat <sebastien.valat.dev@orange.fr>
Date: Tue, 27 Nov 2012 00:07:18 +0100
Subject: [PATCH]  * Add native svg support

---
 Makefile.in                    |   8 +--
 aclocal.m4                     |  43 ++--------------
 doc/Makefile.in                |   2 +-
 include/Makefile.in            |   2 +-
 src/Makefile.in                |   2 +-
 tests/Makefile.in              |   2 +-
 tests/linux/Makefile.in        |   2 +-
 tests/linux/gather/Makefile.in |   2 +-
 tests/ports/Makefile.in        |   2 +-
 tests/rename/Makefile.in       |   2 +-
 tests/xml/Makefile.in          |   2 +-
 utils/Makefile.am              |   2 +-
 utils/Makefile.in              |  62 ++++++++++++++++++++---
 utils/lstopo-cairo.c           |   4 +-
 utils/lstopo-draw.c            |  78 ++++++++++++++---------------
 utils/lstopo-fig.c             |   4 +-
 utils/lstopo-native-svg.c      | 109 +++++++++++++++++++++++++++++++++++++++++
 utils/lstopo-text.c            |   4 +-
 utils/lstopo.c                 |   8 ++-
 utils/lstopo.h                 |   4 +-
 20 files changed, 235 insertions(+), 109 deletions(-)
 create mode 100644 utils/lstopo-native-svg.c

diff --git a/Makefile.in b/Makefile.in
index c192bac..34c6034 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
@@ -774,9 +774,9 @@ distcheck: dist
 	*.zip*) \
 	  unzip $(distdir).zip ;;\
 	esac
-	chmod -R a-w $(distdir); chmod u+w $(distdir)
-	mkdir $(distdir)/_build
-	mkdir $(distdir)/_inst
+	chmod -R a-w $(distdir)
+	chmod u+w $(distdir)
+	mkdir $(distdir)/_build $(distdir)/_inst
 	chmod a-w $(distdir)
 	test -d $(distdir)/_build || exit 0; \
 	dc_install_base=`$(am__cd) $(distdir)/_inst && pwd | sed -e 's,^[^:\\/]:[\\/],/,'` \
diff --git a/aclocal.m4 b/aclocal.m4
index 346a83c..eb8ce0e 100644
--- a/aclocal.m4
+++ b/aclocal.m4
@@ -1,4 +1,4 @@
-# generated automatically by aclocal 1.12.2 -*- Autoconf -*-
+# generated automatically by aclocal 1.12.4 -*- Autoconf -*-
 
 # Copyright (C) 1996-2012 Free Software Foundation, Inc.
 
@@ -25,8 +25,6 @@ To do so, use the procedure documented by the package, typically 'autoreconf'.])
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 8
-
 # AM_AUTOMAKE_VERSION(VERSION)
 # ----------------------------
 # Automake X.Y traces this macro to ensure aclocal.m4 has been
@@ -36,7 +34,7 @@ AC_DEFUN([AM_AUTOMAKE_VERSION],
 [am__api_version='1.12'
 dnl Some users find AM_AUTOMAKE_VERSION and mistake it for a way to
 dnl require some minimum version.  Point them to the right macro.
-m4_if([$1], [1.12.2], [],
+m4_if([$1], [1.12.4], [],
       [AC_FATAL([Do not call $0, use AM_INIT_AUTOMAKE([$1]).])])dnl
 ])
 
@@ -52,7 +50,7 @@ m4_define([_AM_AUTOCONF_VERSION], [])
 # Call AM_AUTOMAKE_VERSION and AM_AUTOMAKE_VERSION so they can be traced.
 # This function is AC_REQUIREd by AM_INIT_AUTOMAKE.
 AC_DEFUN([AM_SET_CURRENT_AUTOMAKE_VERSION],
-[AM_AUTOMAKE_VERSION([1.12.2])dnl
+[AM_AUTOMAKE_VERSION([1.12.4])dnl
 m4_ifndef([AC_AUTOCONF_VERSION],
   [m4_copy([m4_PACKAGE_VERSION], [AC_AUTOCONF_VERSION])])dnl
 _AM_AUTOCONF_VERSION(m4_defn([AC_AUTOCONF_VERSION]))])
@@ -63,8 +61,6 @@ _AM_AUTOCONF_VERSION(m4_defn([AC_AUTOCONF_VERSION]))])
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_PROG_AR([ACT-IF-FAIL])
 # -------------------------
 # Try to determine the archiver interface, and trigger the ar-lib wrapper
@@ -126,8 +122,6 @@ AC_SUBST([AR])dnl
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
-
 # For projects using AC_CONFIG_AUX_DIR([foo]), Autoconf sets
 # $ac_aux_dir to '$srcdir/foo'.  In other projects, it is set to
 # '$srcdir', '$srcdir/..', or '$srcdir/../..'.
@@ -181,8 +175,6 @@ am_aux_dir=`cd $ac_aux_dir && pwd`
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 10
-
 # AM_CONDITIONAL(NAME, SHELL-CONDITION)
 # -------------------------------------
 # Define a conditional.
@@ -214,7 +206,6 @@ fi])])
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 17
 
 # There are a few dirty hacks below to avoid letting 'AC_PROG_CC' be
 # written in clear, in which case automake, when reading aclocal.m4,
@@ -406,7 +397,6 @@ _AM_SUBST_NOTMAKE([am__nodep])dnl
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 6
 
 # _AM_OUTPUT_DEPENDENCY_COMMANDS
 # ------------------------------
@@ -483,8 +473,6 @@ AC_DEFUN([AM_OUTPUT_DEPENDENCY_COMMANDS],
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 19
-
 # This macro actually does too much.  Some checks are only needed if
 # your package does certain things.  But this isn't really a big deal.
 
@@ -636,8 +624,6 @@ echo "timestamp for $_am_arg" >`AS_DIRNAME(["$_am_arg"])`/stamp-h[]$_am_stamp_co
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 8
-
 # AM_PROG_INSTALL_SH
 # ------------------
 # Define $install_sh.
@@ -659,8 +645,6 @@ AC_SUBST([install_sh])])
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
-
 # Check whether the underlying file-system supports filenames
 # with a leading dot.  For instance MS-DOS doesn't.
 AC_DEFUN([AM_SET_LEADING_DOT],
@@ -682,8 +666,6 @@ AC_SUBST([am__leading_dot])])
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
-
 # AM_MAKE_INCLUDE()
 # -----------------
 # Check to see how make treats includes.
@@ -732,8 +714,6 @@ rm -f confinc confmf
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 6
-
 # AM_PROG_CC_C_O
 # --------------
 # Like AC_PROG_CC_C_O, but changed for automake.
@@ -768,8 +748,6 @@ m4_define([AC_PROG_CC],
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 7
-
 # AM_MISSING_PROG(NAME, PROGRAM)
 # ------------------------------
 AC_DEFUN([AM_MISSING_PROG],
@@ -777,7 +755,6 @@ AC_DEFUN([AM_MISSING_PROG],
 $1=${$1-"${am_missing_run}$2"}
 AC_SUBST($1)])
 
-
 # AM_MISSING_HAS_RUN
 # ------------------
 # Define MISSING if not defined so far and test if it supports --run.
@@ -810,8 +787,6 @@ fi
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 6
-
 # _AM_MANGLE_OPTION(NAME)
 # -----------------------
 AC_DEFUN([_AM_MANGLE_OPTION],
@@ -841,8 +816,6 @@ AC_DEFUN([_AM_IF_OPTION],
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_RUN_LOG(COMMAND)
 # -------------------
 # Run COMMAND, save the exit status in ac_status, and log it.
@@ -862,8 +835,6 @@ AC_DEFUN([AM_RUN_LOG],
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 9
-
 # AM_SANITY_CHECK
 # ---------------
 AC_DEFUN([AM_SANITY_CHECK],
@@ -945,8 +916,6 @@ rm -f conftest.file
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 3
-
 # AM_SILENT_RULES([DEFAULT])
 # --------------------------
 # Enable less verbose build rules; with the default set to DEFAULT
@@ -1007,8 +976,6 @@ _AM_SUBST_NOTMAKE([AM_BACKSLASH])dnl
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
-
 # AM_PROG_INSTALL_STRIP
 # ---------------------
 # One issue with vendor 'install' (even GNU) is that you can't
@@ -1037,8 +1004,6 @@ AC_SUBST([INSTALL_STRIP_PROGRAM])])
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 3
-
 # _AM_SUBST_NOTMAKE(VARIABLE)
 # ---------------------------
 # Prevent Automake from outputting VARIABLE = @VARIABLE@ in Makefile.in.
@@ -1058,8 +1023,6 @@ AC_DEFUN([AM_SUBST_NOTMAKE], [_AM_SUBST_NOTMAKE($@)])
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 3
-
 # _AM_PROG_TAR(FORMAT)
 # --------------------
 # Check how to create a tarball in format FORMAT.
diff --git a/doc/Makefile.in b/doc/Makefile.in
index b09eaf1..a1f1032 100644
--- a/doc/Makefile.in
+++ b/doc/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
diff --git a/include/Makefile.in b/include/Makefile.in
index 6dd0c83..f25cec3 100644
--- a/include/Makefile.in
+++ b/include/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
diff --git a/src/Makefile.in b/src/Makefile.in
index 6a644f3..1a425cd 100644
--- a/src/Makefile.in
+++ b/src/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
diff --git a/tests/Makefile.in b/tests/Makefile.in
index 890ddb5..0616436 100644
--- a/tests/Makefile.in
+++ b/tests/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
diff --git a/tests/linux/Makefile.in b/tests/linux/Makefile.in
index 75760fb..e234dea 100644
--- a/tests/linux/Makefile.in
+++ b/tests/linux/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
diff --git a/tests/linux/gather/Makefile.in b/tests/linux/gather/Makefile.in
index f521bb8..88c41c5 100644
--- a/tests/linux/gather/Makefile.in
+++ b/tests/linux/gather/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
diff --git a/tests/ports/Makefile.in b/tests/ports/Makefile.in
index a1a4e25..c75cbab 100644
--- a/tests/ports/Makefile.in
+++ b/tests/ports/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
diff --git a/tests/rename/Makefile.in b/tests/rename/Makefile.in
index 68afcc9..76bc86e 100644
--- a/tests/rename/Makefile.in
+++ b/tests/rename/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
diff --git a/tests/xml/Makefile.in b/tests/xml/Makefile.in
index 540eeba..5217403 100644
--- a/tests/xml/Makefile.in
+++ b/tests/xml/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
diff --git a/utils/Makefile.am b/utils/Makefile.am
index 3415c3c..8f784bd 100644
--- a/utils/Makefile.am
+++ b/utils/Makefile.am
@@ -19,7 +19,7 @@ if HWLOC_BUILD_UTILS
 bin_PROGRAMS = lstopo-no-graphics hwloc-assembler hwloc-calc hwloc-bind hwloc-distances hwloc-distrib hwloc-ps
 endif
 
-lstopo_no_graphics_SOURCES = lstopo.h lstopo.c lstopo-color.c lstopo-text.c lstopo-draw.c lstopo-fig.c lstopo-xml.c
+lstopo_no_graphics_SOURCES = lstopo.h lstopo.c lstopo-color.c lstopo-text.c lstopo-draw.c lstopo-fig.c lstopo-xml.c lstopo-native-svg.c
 lstopo_no_graphics_CFLAGS = $(HWLOC_LIBXML2_CFLAGS) $(HWLOC_PCI_CFLAGS)
 lstopo_no_graphics_LDADD = $(LDADD) -lm $(HWLOC_TERMCAP_LIBS)
 if HWLOC_BUILD_UTILS
diff --git a/utils/Makefile.in b/utils/Makefile.in
index a61024d..72daaf5 100644
--- a/utils/Makefile.in
+++ b/utils/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.12.2 from Makefile.am.
+# Makefile.in generated by automake 1.12.4 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2012 Free Software Foundation, Inc.
@@ -143,10 +143,11 @@ hwloc_ps_LDADD = $(LDADD)
 hwloc_ps_DEPENDENCIES = $(HWLOC_top_builddir)/src/libhwloc.la
 am__lstopo_SOURCES_DIST = lstopo.h lstopo.c lstopo-color.c \
 	lstopo-text.c lstopo-draw.c lstopo-fig.c lstopo-xml.c \
-	lstopo-cairo.c lstopo-windows.c
+	lstopo-native-svg.c lstopo-cairo.c lstopo-windows.c
 am__objects_1 = lstopo-lstopo.$(OBJEXT) lstopo-lstopo-color.$(OBJEXT) \
 	lstopo-lstopo-text.$(OBJEXT) lstopo-lstopo-draw.$(OBJEXT) \
-	lstopo-lstopo-fig.$(OBJEXT) lstopo-lstopo-xml.$(OBJEXT)
+	lstopo-lstopo-fig.$(OBJEXT) lstopo-lstopo-xml.$(OBJEXT) \
+	lstopo-lstopo-native-svg.$(OBJEXT)
 @HWLOC_BUILD_UTILS_TRUE@@HWLOC_HAVE_CAIRO_TRUE@am__objects_2 = lstopo-lstopo-cairo.$(OBJEXT)
 @HWLOC_BUILD_UTILS_TRUE@@HWLOC_HAVE_WINDOWS_TRUE@am__objects_3 = lstopo-lstopo-windows.$(OBJEXT)
 @HWLOC_BUILD_UTILS_TRUE@am_lstopo_OBJECTS = $(am__objects_1) \
@@ -166,7 +167,8 @@ am_lstopo_no_graphics_OBJECTS = lstopo_no_graphics-lstopo.$(OBJEXT) \
 	lstopo_no_graphics-lstopo-text.$(OBJEXT) \
 	lstopo_no_graphics-lstopo-draw.$(OBJEXT) \
 	lstopo_no_graphics-lstopo-fig.$(OBJEXT) \
-	lstopo_no_graphics-lstopo-xml.$(OBJEXT)
+	lstopo_no_graphics-lstopo-xml.$(OBJEXT) \
+	lstopo_no_graphics-lstopo-native-svg.$(OBJEXT)
 lstopo_no_graphics_OBJECTS = $(am_lstopo_no_graphics_OBJECTS)
 lstopo_no_graphics_DEPENDENCIES = $(LDADD) $(am__DEPENDENCIES_1)
 lstopo_no_graphics_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
@@ -175,13 +177,14 @@ lstopo_no_graphics_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(LDFLAGS) -o $@
 am__lstopo_win_SOURCES_DIST = lstopo.h lstopo.c lstopo-color.c \
 	lstopo-text.c lstopo-draw.c lstopo-fig.c lstopo-xml.c \
-	lstopo-cairo.c lstopo-windows.c
+	lstopo-native-svg.c lstopo-cairo.c lstopo-windows.c
 am__objects_4 = lstopo_win-lstopo.$(OBJEXT) \
 	lstopo_win-lstopo-color.$(OBJEXT) \
 	lstopo_win-lstopo-text.$(OBJEXT) \
 	lstopo_win-lstopo-draw.$(OBJEXT) \
 	lstopo_win-lstopo-fig.$(OBJEXT) \
-	lstopo_win-lstopo-xml.$(OBJEXT)
+	lstopo_win-lstopo-xml.$(OBJEXT) \
+	lstopo_win-lstopo-native-svg.$(OBJEXT)
 @HWLOC_BUILD_UTILS_TRUE@@HWLOC_HAVE_CAIRO_TRUE@am__objects_5 = lstopo_win-lstopo-cairo.$(OBJEXT)
 @HWLOC_BUILD_UTILS_TRUE@@HWLOC_HAVE_WINDOWS_TRUE@am__objects_6 = lstopo_win-lstopo-windows.$(OBJEXT)
 @HWLOC_BUILD_UTILS_TRUE@am__objects_7 = $(am__objects_4) \
@@ -467,7 +470,7 @@ EXTRA_DIST = test-hwloc-assembler.input1 test-hwloc-assembler.input2 \
 	test-hwloc-distances.output test-hwloc-distrib.output \
 	test-hwloc-ls.output $(am__append_8)
 noinst_HEADERS = misc.h
-lstopo_no_graphics_SOURCES = lstopo.h lstopo.c lstopo-color.c lstopo-text.c lstopo-draw.c lstopo-fig.c lstopo-xml.c
+lstopo_no_graphics_SOURCES = lstopo.h lstopo.c lstopo-color.c lstopo-text.c lstopo-draw.c lstopo-fig.c lstopo-xml.c lstopo-native-svg.c
 lstopo_no_graphics_CFLAGS = $(HWLOC_LIBXML2_CFLAGS) $(HWLOC_PCI_CFLAGS)
 lstopo_no_graphics_LDADD = $(LDADD) -lm $(HWLOC_TERMCAP_LIBS)
 @HWLOC_BUILD_UTILS_TRUE@lstopo_SOURCES =  \
@@ -670,6 +673,7 @@ distclean-compile:
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo-lstopo-color.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo-lstopo-draw.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo-lstopo-fig.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo-lstopo-native-svg.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo-lstopo-text.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo-lstopo-windows.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo-lstopo-xml.Po@am__quote@
@@ -677,6 +681,7 @@ distclean-compile:
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_no_graphics-lstopo-color.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_no_graphics-lstopo-draw.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_no_graphics-lstopo-fig.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_no_graphics-lstopo-native-svg.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_no_graphics-lstopo-text.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_no_graphics-lstopo-xml.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_no_graphics-lstopo.Po@am__quote@
@@ -684,6 +689,7 @@ distclean-compile:
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_win-lstopo-color.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_win-lstopo-draw.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_win-lstopo-fig.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_win-lstopo-native-svg.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_win-lstopo-text.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_win-lstopo-windows.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lstopo_win-lstopo-xml.Po@am__quote@
@@ -797,6 +803,20 @@ lstopo-lstopo-xml.obj: lstopo-xml.c
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_CPPFLAGS) $(CPPFLAGS) $(lstopo_CFLAGS) $(CFLAGS) -c -o lstopo-lstopo-xml.obj `if test -f 'lstopo-xml.c'; then $(CYGPATH_W) 'lstopo-xml.c'; else $(CYGPATH_W) '$(srcdir)/lstopo-xml.c'; fi`
 
+lstopo-lstopo-native-svg.o: lstopo-native-svg.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_CPPFLAGS) $(CPPFLAGS) $(lstopo_CFLAGS) $(CFLAGS) -MT lstopo-lstopo-native-svg.o -MD -MP -MF $(DEPDIR)/lstopo-lstopo-native-svg.Tpo -c -o lstopo-lstopo-native-svg.o `test -f 'lstopo-native-svg.c' || echo '$(srcdir)/'`lstopo-native-svg.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lstopo-lstopo-native-svg.Tpo $(DEPDIR)/lstopo-lstopo-native-svg.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='lstopo-native-svg.c' object='lstopo-lstopo-native-svg.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_CPPFLAGS) $(CPPFLAGS) $(lstopo_CFLAGS) $(CFLAGS) -c -o lstopo-lstopo-native-svg.o `test -f 'lstopo-native-svg.c' || echo '$(srcdir)/'`lstopo-native-svg.c
+
+lstopo-lstopo-native-svg.obj: lstopo-native-svg.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_CPPFLAGS) $(CPPFLAGS) $(lstopo_CFLAGS) $(CFLAGS) -MT lstopo-lstopo-native-svg.obj -MD -MP -MF $(DEPDIR)/lstopo-lstopo-native-svg.Tpo -c -o lstopo-lstopo-native-svg.obj `if test -f 'lstopo-native-svg.c'; then $(CYGPATH_W) 'lstopo-native-svg.c'; else $(CYGPATH_W) '$(srcdir)/lstopo-native-svg.c'; fi`
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lstopo-lstopo-native-svg.Tpo $(DEPDIR)/lstopo-lstopo-native-svg.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='lstopo-native-svg.c' object='lstopo-lstopo-native-svg.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_CPPFLAGS) $(CPPFLAGS) $(lstopo_CFLAGS) $(CFLAGS) -c -o lstopo-lstopo-native-svg.obj `if test -f 'lstopo-native-svg.c'; then $(CYGPATH_W) 'lstopo-native-svg.c'; else $(CYGPATH_W) '$(srcdir)/lstopo-native-svg.c'; fi`
+
 lstopo-lstopo-cairo.o: lstopo-cairo.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_CPPFLAGS) $(CPPFLAGS) $(lstopo_CFLAGS) $(CFLAGS) -MT lstopo-lstopo-cairo.o -MD -MP -MF $(DEPDIR)/lstopo-lstopo-cairo.Tpo -c -o lstopo-lstopo-cairo.o `test -f 'lstopo-cairo.c' || echo '$(srcdir)/'`lstopo-cairo.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lstopo-lstopo-cairo.Tpo $(DEPDIR)/lstopo-lstopo-cairo.Po
@@ -909,6 +929,20 @@ lstopo_no_graphics-lstopo-xml.obj: lstopo-xml.c
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(lstopo_no_graphics_CFLAGS) $(CFLAGS) -c -o lstopo_no_graphics-lstopo-xml.obj `if test -f 'lstopo-xml.c'; then $(CYGPATH_W) 'lstopo-xml.c'; else $(CYGPATH_W) '$(srcdir)/lstopo-xml.c'; fi`
 
+lstopo_no_graphics-lstopo-native-svg.o: lstopo-native-svg.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(lstopo_no_graphics_CFLAGS) $(CFLAGS) -MT lstopo_no_graphics-lstopo-native-svg.o -MD -MP -MF $(DEPDIR)/lstopo_no_graphics-lstopo-native-svg.Tpo -c -o lstopo_no_graphics-lstopo-native-svg.o `test -f 'lstopo-native-svg.c' || echo '$(srcdir)/'`lstopo-native-svg.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lstopo_no_graphics-lstopo-native-svg.Tpo $(DEPDIR)/lstopo_no_graphics-lstopo-native-svg.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='lstopo-native-svg.c' object='lstopo_no_graphics-lstopo-native-svg.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(lstopo_no_graphics_CFLAGS) $(CFLAGS) -c -o lstopo_no_graphics-lstopo-native-svg.o `test -f 'lstopo-native-svg.c' || echo '$(srcdir)/'`lstopo-native-svg.c
+
+lstopo_no_graphics-lstopo-native-svg.obj: lstopo-native-svg.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(lstopo_no_graphics_CFLAGS) $(CFLAGS) -MT lstopo_no_graphics-lstopo-native-svg.obj -MD -MP -MF $(DEPDIR)/lstopo_no_graphics-lstopo-native-svg.Tpo -c -o lstopo_no_graphics-lstopo-native-svg.obj `if test -f 'lstopo-native-svg.c'; then $(CYGPATH_W) 'lstopo-native-svg.c'; else $(CYGPATH_W) '$(srcdir)/lstopo-native-svg.c'; fi`
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lstopo_no_graphics-lstopo-native-svg.Tpo $(DEPDIR)/lstopo_no_graphics-lstopo-native-svg.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='lstopo-native-svg.c' object='lstopo_no_graphics-lstopo-native-svg.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(lstopo_no_graphics_CFLAGS) $(CFLAGS) -c -o lstopo_no_graphics-lstopo-native-svg.obj `if test -f 'lstopo-native-svg.c'; then $(CYGPATH_W) 'lstopo-native-svg.c'; else $(CYGPATH_W) '$(srcdir)/lstopo-native-svg.c'; fi`
+
 lstopo_win-lstopo.o: lstopo.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_win_CPPFLAGS) $(CPPFLAGS) $(lstopo_win_CFLAGS) $(CFLAGS) -MT lstopo_win-lstopo.o -MD -MP -MF $(DEPDIR)/lstopo_win-lstopo.Tpo -c -o lstopo_win-lstopo.o `test -f 'lstopo.c' || echo '$(srcdir)/'`lstopo.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lstopo_win-lstopo.Tpo $(DEPDIR)/lstopo_win-lstopo.Po
@@ -993,6 +1027,20 @@ lstopo_win-lstopo-xml.obj: lstopo-xml.c
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_win_CPPFLAGS) $(CPPFLAGS) $(lstopo_win_CFLAGS) $(CFLAGS) -c -o lstopo_win-lstopo-xml.obj `if test -f 'lstopo-xml.c'; then $(CYGPATH_W) 'lstopo-xml.c'; else $(CYGPATH_W) '$(srcdir)/lstopo-xml.c'; fi`
 
+lstopo_win-lstopo-native-svg.o: lstopo-native-svg.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_win_CPPFLAGS) $(CPPFLAGS) $(lstopo_win_CFLAGS) $(CFLAGS) -MT lstopo_win-lstopo-native-svg.o -MD -MP -MF $(DEPDIR)/lstopo_win-lstopo-native-svg.Tpo -c -o lstopo_win-lstopo-native-svg.o `test -f 'lstopo-native-svg.c' || echo '$(srcdir)/'`lstopo-native-svg.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lstopo_win-lstopo-native-svg.Tpo $(DEPDIR)/lstopo_win-lstopo-native-svg.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='lstopo-native-svg.c' object='lstopo_win-lstopo-native-svg.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_win_CPPFLAGS) $(CPPFLAGS) $(lstopo_win_CFLAGS) $(CFLAGS) -c -o lstopo_win-lstopo-native-svg.o `test -f 'lstopo-native-svg.c' || echo '$(srcdir)/'`lstopo-native-svg.c
+
+lstopo_win-lstopo-native-svg.obj: lstopo-native-svg.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_win_CPPFLAGS) $(CPPFLAGS) $(lstopo_win_CFLAGS) $(CFLAGS) -MT lstopo_win-lstopo-native-svg.obj -MD -MP -MF $(DEPDIR)/lstopo_win-lstopo-native-svg.Tpo -c -o lstopo_win-lstopo-native-svg.obj `if test -f 'lstopo-native-svg.c'; then $(CYGPATH_W) 'lstopo-native-svg.c'; else $(CYGPATH_W) '$(srcdir)/lstopo-native-svg.c'; fi`
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lstopo_win-lstopo-native-svg.Tpo $(DEPDIR)/lstopo_win-lstopo-native-svg.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='lstopo-native-svg.c' object='lstopo_win-lstopo-native-svg.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_win_CPPFLAGS) $(CPPFLAGS) $(lstopo_win_CFLAGS) $(CFLAGS) -c -o lstopo_win-lstopo-native-svg.obj `if test -f 'lstopo-native-svg.c'; then $(CYGPATH_W) 'lstopo-native-svg.c'; else $(CYGPATH_W) '$(srcdir)/lstopo-native-svg.c'; fi`
+
 lstopo_win-lstopo-cairo.o: lstopo-cairo.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lstopo_win_CPPFLAGS) $(CPPFLAGS) $(lstopo_win_CFLAGS) $(CFLAGS) -MT lstopo_win-lstopo-cairo.o -MD -MP -MF $(DEPDIR)/lstopo_win-lstopo-cairo.Tpo -c -o lstopo_win-lstopo-cairo.o `test -f 'lstopo-cairo.c' || echo '$(srcdir)/'`lstopo-cairo.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lstopo_win-lstopo-cairo.Tpo $(DEPDIR)/lstopo_win-lstopo-cairo.Po
diff --git a/utils/lstopo-cairo.c b/utils/lstopo-cairo.c
index 3b28710..81ea03f 100644
--- a/utils/lstopo-cairo.c
+++ b/utils/lstopo-cairo.c
@@ -49,7 +49,7 @@
 #if (CAIRO_HAS_XLIB_SURFACE + CAIRO_HAS_PNG_FUNCTIONS + CAIRO_HAS_PDF_SURFACE + CAIRO_HAS_PS_SURFACE + CAIRO_HAS_SVG_SURFACE)
 /* Cairo methods */
 static void
-topo_cairo_box(void *output, int r, int g, int b, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned width, unsigned y, unsigned height)
+topo_cairo_box(void *output, int r, int g, int b, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned width, unsigned y, unsigned height,hwloc_obj_t level)
 {
   cairo_t *c = output;
   cairo_rectangle(c, x, y, width, height);
@@ -74,7 +74,7 @@ topo_cairo_line(void *output, int r, int g, int b, unsigned depth __hwloc_attrib
 }
 
 static void
-topo_cairo_text(void *output, int r, int g, int b, int size, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned y, const char *text)
+topo_cairo_text(void *output, int r, int g, int b, int size, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned y, const char *text,hwloc_obj_t level)
 {
   cairo_t *c = output;
   cairo_move_to(c, x, y + size);
diff --git a/utils/lstopo-draw.c b/utils/lstopo-draw.c
index 20e1bdb..d9ed842 100644
--- a/utils/lstopo-draw.c
+++ b/utils/lstopo-draw.c
@@ -109,9 +109,9 @@ static int prefer_ratio(float ratio1, float ratio2) {
 
 static void* null_start(void *output, int width __hwloc_attribute_unused, int height __hwloc_attribute_unused) { return output; }
 static void null_declare_color(void *output __hwloc_attribute_unused, int r __hwloc_attribute_unused, int g __hwloc_attribute_unused, int b __hwloc_attribute_unused) { }
-static void null_box(void *output __hwloc_attribute_unused, int r __hwloc_attribute_unused, int g __hwloc_attribute_unused, int b __hwloc_attribute_unused, unsigned depth __hwloc_attribute_unused, unsigned x __hwloc_attribute_unused, unsigned width __hwloc_attribute_unused, unsigned y __hwloc_attribute_unused, unsigned height __hwloc_attribute_unused) { }
+static void null_box(void *output __hwloc_attribute_unused, int r __hwloc_attribute_unused, int g __hwloc_attribute_unused, int b __hwloc_attribute_unused, unsigned depth __hwloc_attribute_unused, unsigned x __hwloc_attribute_unused, unsigned width __hwloc_attribute_unused, unsigned y __hwloc_attribute_unused, unsigned height __hwloc_attribute_unused,hwloc_obj_t level) { }
 static void null_line(void *output __hwloc_attribute_unused, int r __hwloc_attribute_unused, int g __hwloc_attribute_unused, int b __hwloc_attribute_unused, unsigned depth __hwloc_attribute_unused, unsigned x1 __hwloc_attribute_unused, unsigned y1_arg __hwloc_attribute_unused, unsigned x2 __hwloc_attribute_unused, unsigned y2 __hwloc_attribute_unused) { }
-static void null_text(void *output __hwloc_attribute_unused, int r __hwloc_attribute_unused, int g __hwloc_attribute_unused, int b __hwloc_attribute_unused, int size __hwloc_attribute_unused, unsigned depth __hwloc_attribute_unused, unsigned x __hwloc_attribute_unused, unsigned y __hwloc_attribute_unused, const char *text __hwloc_attribute_unused) { }
+static void null_text(void *output __hwloc_attribute_unused, int r __hwloc_attribute_unused, int g __hwloc_attribute_unused, int b __hwloc_attribute_unused, int size __hwloc_attribute_unused, unsigned depth __hwloc_attribute_unused, unsigned x __hwloc_attribute_unused, unsigned y __hwloc_attribute_unused, const char *text __hwloc_attribute_unused,hwloc_obj_t level) { }
 
 static struct draw_methods null_draw_methods = {
   null_start,
@@ -424,10 +424,10 @@ pci_device_draw(hwloc_topology_t topology __hwloc_attribute_unused, struct draw_
 
   RECURSE_RECT(level, &null_draw_methods, gridsize, gridsize);
 
-  methods->box(output, PCI_DEVICE_R_COLOR, PCI_DEVICE_G_COLOR, PCI_DEVICE_B_COLOR, depth, x, *retwidth, y, *retheight);
+  methods->box(output, PCI_DEVICE_R_COLOR, PCI_DEVICE_G_COLOR, PCI_DEVICE_B_COLOR, depth, x, *retwidth, y, *retheight,level);
 
   if (fontsize)
-    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text);
+    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
 
   RECURSE_RECT(level, methods, gridsize, gridsize);
 
@@ -452,10 +452,10 @@ os_device_draw(hwloc_topology_t topology __hwloc_attribute_unused, struct draw_m
   *retwidth = totwidth;
   *retheight = totheight;
 
-  methods->box(output, OS_DEVICE_R_COLOR, OS_DEVICE_G_COLOR, OS_DEVICE_B_COLOR, depth, x, *retwidth, y, *retheight);
+  methods->box(output, OS_DEVICE_R_COLOR, OS_DEVICE_G_COLOR, OS_DEVICE_B_COLOR, depth, x, *retwidth, y, *retheight,level);
 
   if (fontsize)
-    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, level->name);
+    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, level->name,level);
 }
 
 static void
@@ -473,7 +473,7 @@ bridge_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical
   RECURSE_VERT(level, &null_draw_methods, gridsize, 0);
 
   /* Square and left link */
-  methods->box(output, BRIDGE_R_COLOR, BRIDGE_G_COLOR, BRIDGE_B_COLOR, depth, x, gridsize, y + PCI_HEIGHT/2 - gridsize/2, gridsize);
+  methods->box(output, BRIDGE_R_COLOR, BRIDGE_G_COLOR, BRIDGE_B_COLOR, depth, x, gridsize, y + PCI_HEIGHT/2 - gridsize/2, gridsize,level);
   methods->line(output, 0, 0, 0, depth, x + gridsize, y + PCI_HEIGHT/2, x + 2*gridsize, y + PCI_HEIGHT/2);
 
   if (level->arity > 0) {
@@ -500,7 +500,7 @@ bridge_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical
         if (speed != 0.) {
           char text[4];
           snprintf(text, sizeof(text), "%0.1f", subobjs[i]->attr->pcidev.linkspeed);
-          methods->text(output, 0, 0, 0, fontsize, depth-1, x + 2*gridsize + gridsize, y + totheight, text);
+          methods->text(output, 0, 0, 0, fontsize, depth-1, x + 2*gridsize + gridsize, y + totheight, text,level);
         }
       }
     RECURSE_END_VERT(gridsize, 0);
@@ -530,7 +530,7 @@ pu_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical, hw
 
   if (hwloc_bitmap_isset(level->online_cpuset, level->os_index))
     if (!hwloc_bitmap_isset(level->allowed_cpuset, level->os_index))
-      methods->box(output, FORBIDDEN_R_COLOR, FORBIDDEN_G_COLOR, FORBIDDEN_B_COLOR, depth, x, *retwidth, y, *retheight);
+      methods->box(output, FORBIDDEN_R_COLOR, FORBIDDEN_G_COLOR, FORBIDDEN_B_COLOR, depth, x, *retwidth, y, *retheight,level);
     else {
       hwloc_bitmap_t bind = hwloc_bitmap_alloc();
       if (pid != (hwloc_pid_t) -1 && pid != 0)
@@ -538,21 +538,21 @@ pu_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical, hw
       else if (pid == 0)
         hwloc_get_cpubind(topology, bind, 0);
       if (bind && hwloc_bitmap_isset(bind, level->os_index))
-        methods->box(output, RUNNING_R_COLOR, RUNNING_G_COLOR, RUNNING_B_COLOR, depth, x, *retwidth, y, *retheight);
+        methods->box(output, RUNNING_R_COLOR, RUNNING_G_COLOR, RUNNING_B_COLOR, depth, x, *retwidth, y, *retheight,level);
       else
-        methods->box(output, THREAD_R_COLOR, THREAD_G_COLOR, THREAD_B_COLOR, depth, x, *retwidth, y, *retheight);
+        methods->box(output, THREAD_R_COLOR, THREAD_G_COLOR, THREAD_B_COLOR, depth, x, *retwidth, y, *retheight,level);
       hwloc_bitmap_free(bind);
     }
   else
-    methods->box(output, OFFLINE_R_COLOR, OFFLINE_G_COLOR, OFFLINE_B_COLOR, depth, x, *retwidth, y, *retheight);
+    methods->box(output, OFFLINE_R_COLOR, OFFLINE_G_COLOR, OFFLINE_B_COLOR, depth, x, *retwidth, y, *retheight,level);
 
   if (fontsize) {
     char text[64];
     lstopo_obj_snprintf(text, sizeof(text), level, logical);
     if (hwloc_bitmap_isset(level->online_cpuset, level->os_index))
-      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text);
+      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
     else
-      methods->text(output, 0xff, 0xff, 0xff, fontsize, depth-1, x + gridsize, y + gridsize, text);
+      methods->text(output, 0xff, 0xff, 0xff, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
   }
 
   RECURSE_RECT(level, methods, 0, gridsize);
@@ -573,13 +573,13 @@ cache_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical,
 
   RECURSE_RECT(level, &null_draw_methods, separator, 0);
 
-  methods->box(output, CACHE_R_COLOR, CACHE_G_COLOR, CACHE_B_COLOR, depth, x, totwidth, y, myheight - gridsize);
+  methods->box(output, CACHE_R_COLOR, CACHE_G_COLOR, CACHE_B_COLOR, depth, x, totwidth, y, myheight - gridsize,level);
 
   if (fontsize) {
     char text[64];
 
     lstopo_obj_snprintf(text, sizeof(text), level, logical);
-    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text);
+    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
   }
 
   RECURSE_RECT(level, methods, separator, 0);
@@ -598,12 +598,12 @@ core_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical,
 
   RECURSE_RECT(level, &null_draw_methods, 0, gridsize);
 
-  methods->box(output, CORE_R_COLOR, CORE_G_COLOR, CORE_B_COLOR, depth, x, totwidth, y, totheight);
+  methods->box(output, CORE_R_COLOR, CORE_G_COLOR, CORE_B_COLOR, depth, x, totwidth, y, totheight,level);
 
   if (fontsize) {
     char text[64];
     lstopo_obj_snprintf(text, sizeof(text), level, logical);
-    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text);
+    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
   }
 
   RECURSE_RECT(level, methods, 0, gridsize);
@@ -622,12 +622,12 @@ socket_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical
 
   RECURSE_RECT(level, &null_draw_methods, gridsize, gridsize);
 
-  methods->box(output, SOCKET_R_COLOR, SOCKET_G_COLOR, SOCKET_B_COLOR, depth, x, totwidth, y, totheight);
+  methods->box(output, SOCKET_R_COLOR, SOCKET_G_COLOR, SOCKET_B_COLOR, depth, x, totwidth, y, totheight,level);
 
   if (fontsize) {
     char text[64];
     lstopo_obj_snprintf(text, sizeof(text), level, logical);
-    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text);
+    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
   }
 
   RECURSE_RECT(level, methods, gridsize, gridsize);
@@ -656,15 +656,15 @@ node_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical,
   RECURSE_RECT(level, &null_draw_methods, gridsize, gridsize);
 
   /* Draw the epoxy box */
-  methods->box(output, NODE_R_COLOR, NODE_G_COLOR, NODE_B_COLOR, depth, x, totwidth, y, totheight);
+  methods->box(output, NODE_R_COLOR, NODE_G_COLOR, NODE_B_COLOR, depth, x, totwidth, y, totheight,level);
   /* Draw the memory box */
-  methods->box(output, MEMORY_R_COLOR, MEMORY_G_COLOR, MEMORY_B_COLOR, depth-1, x + gridsize, totwidth - 2 * gridsize, y + gridsize, myheight - gridsize);
+  methods->box(output, MEMORY_R_COLOR, MEMORY_G_COLOR, MEMORY_B_COLOR, depth-1, x + gridsize, totwidth - 2 * gridsize, y + gridsize, myheight - gridsize,level);
 
   if (fontsize) {
     char text[64];
     /* Output text */
     lstopo_obj_snprintf(text, sizeof(text), level, logical);
-    methods->text(output, 0, 0, 0, fontsize, depth-2, x + 2 * gridsize, y + 2 * gridsize, text);
+    methods->text(output, 0, 0, 0, fontsize, depth-2, x + 2 * gridsize, y + 2 * gridsize, text,level);
   }
 
   /* Restart, now really drawing sublevels */
@@ -685,12 +685,12 @@ machine_draw(hwloc_topology_t topology, struct draw_methods *methods, int logica
 
   RECURSE_RECT(level, &null_draw_methods, gridsize, gridsize);
 
-  methods->box(output, MACHINE_R_COLOR, MACHINE_G_COLOR, MACHINE_B_COLOR, depth, x, totwidth, y, totheight);
+  methods->box(output, MACHINE_R_COLOR, MACHINE_G_COLOR, MACHINE_B_COLOR, depth, x, totwidth, y, totheight,level);
 
   if (fontsize) {
     char text[64];
     lstopo_obj_snprintf(text, sizeof(text), level, logical);
-    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text);
+    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
   }
 
   RECURSE_RECT(level, methods, gridsize, gridsize);
@@ -754,12 +754,12 @@ system_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical
   else
     RECURSE_RECT(level, &null_draw_methods, gridsize, gridsize);
 
-  methods->box(output, SYSTEM_R_COLOR, SYSTEM_G_COLOR, SYSTEM_B_COLOR, depth, x, totwidth, y, totheight);
+  methods->box(output, SYSTEM_R_COLOR, SYSTEM_G_COLOR, SYSTEM_B_COLOR, depth, x, totwidth, y, totheight,level);
 
   if (fontsize) {
     char text[64];
     lstopo_obj_snprintf(text, sizeof(text), level, logical);
-    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text);
+    methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
   }
 
   if (level->arity > 1 && (level->children[0]->type == HWLOC_OBJ_MACHINE || !level->children[0]->cpuset))
@@ -792,15 +792,15 @@ group_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical,
   else
     RECURSE_RECT(level, &null_draw_methods, gridsize, gridsize);
 
-  methods->box(output, MISC_R_COLOR, MISC_G_COLOR, MISC_B_COLOR, depth, x, totwidth, y, totheight);
+  methods->box(output, MISC_R_COLOR, MISC_G_COLOR, MISC_B_COLOR, depth, x, totwidth, y, totheight,level);
 
   if (fontsize) {
     if (level->name) {
-      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, level->name);
+      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, level->name,level);
     } else {
       char text[64];
       lstopo_obj_snprintf(text, sizeof(text), level, logical);
-      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text);
+      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
     }
   }
 
@@ -828,15 +828,15 @@ misc_draw(hwloc_topology_t topology, struct draw_methods *methods, int logical,
   else
     RECURSE_HORIZ(level, &null_draw_methods, gridsize, 0);
 
-  methods->box(output, MISC_R_COLOR, MISC_G_COLOR, MISC_B_COLOR, depth, x, totwidth, y, boxheight);
+  methods->box(output, MISC_R_COLOR, MISC_G_COLOR, MISC_B_COLOR, depth, x, totwidth, y, boxheight,level);
 
   if (fontsize) {
     if (level->name) {
-      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, level->name);
+      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, level->name,level);
     } else {
       char text[64];
       lstopo_obj_snprintf(text, sizeof(text), level, logical);
-      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text);
+      methods->text(output, 0, 0, 0, fontsize, depth-1, x + gridsize, y + gridsize, text,level);
     }
   }
 
@@ -874,17 +874,17 @@ fig(hwloc_topology_t topology, struct draw_methods *methods, int logical, int le
     }
     if (*hostname) {
       snprintf(text, sizeof(text), "Host: %s", hostname);
-      methods->box(output, 0xff, 0xff, 0xff, depth, 0, totwidth, totheight, gridsize*4 + fontsize*3);
-      methods->text(output, 0, 0, 0, fontsize, depth, gridsize, totheight + gridsize, text);
+      methods->box(output, 0xff, 0xff, 0xff, depth, 0, totwidth, totheight, gridsize*4 + fontsize*3,level);
+      methods->text(output, 0, 0, 0, fontsize, depth, gridsize, totheight + gridsize, text,level);
       offset = gridsize + fontsize;
     } else {
-      methods->box(output, 0xff, 0xff, 0xff, depth, 0, totwidth, totheight, gridsize*3 + fontsize*2);
+      methods->box(output, 0xff, 0xff, 0xff, depth, 0, totwidth, totheight, gridsize*3 + fontsize*2,level);
       offset = 0;
     }
 
     /* Display whether we're showing physical or logical IDs */
     snprintf(text, sizeof(text), "Indexes: %s", logical ? "logical" : "physical");
-    methods->text(output, 0, 0, 0, fontsize, depth, gridsize, totheight + gridsize + offset, text);
+    methods->text(output, 0, 0, 0, fontsize, depth, gridsize, totheight + gridsize + offset, text,level);
 
     /* Display timestamp */
     t = time(NULL);
@@ -906,7 +906,7 @@ fig(hwloc_topology_t topology, struct draw_methods *methods, int logical, int le
       snprintf(text, sizeof(text), "Date: %s", date);
     }
 #endif /* HAVE_STRFTIME */
-    methods->text(output, 0, 0, 0, fontsize, depth, gridsize, totheight + gridsize + offset + fontsize + gridsize, text);
+    methods->text(output, 0, 0, 0, fontsize, depth, gridsize, totheight + gridsize + offset + fontsize + gridsize, text,level);
   }
 }
 
@@ -944,7 +944,7 @@ struct coords {
 };
 
 static void
-getmax_box(void *output, int r __hwloc_attribute_unused, int g __hwloc_attribute_unused, int b __hwloc_attribute_unused, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned width, unsigned y, unsigned height)
+getmax_box(void *output, int r __hwloc_attribute_unused, int g __hwloc_attribute_unused, int b __hwloc_attribute_unused, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned width, unsigned y, unsigned height,hwloc_obj_t level)
 {
   struct coords *coords = output;
 
diff --git a/utils/lstopo-fig.c b/utils/lstopo-fig.c
index 801e3f8..c2f5522 100644
--- a/utils/lstopo-fig.c
+++ b/utils/lstopo-fig.c
@@ -65,7 +65,7 @@ fig_declare_color(void *output_, int r, int g, int b)
 }
 
 static void
-fig_box(void *output_, int r, int g, int b, unsigned depth, unsigned x, unsigned width, unsigned y, unsigned height)
+fig_box(void *output_, int r, int g, int b, unsigned depth, unsigned x, unsigned width, unsigned y, unsigned height,hwloc_obj_t level)
 {
   FILE *output = output_;
   x *= FIG_FACTOR;
@@ -96,7 +96,7 @@ fig_line(void *output_, int r, int g, int b, unsigned depth, unsigned x1, unsign
 }
 
 static void
-fig_text(void *output_, int r, int g, int b, int size, unsigned depth, unsigned x, unsigned y, const char *text)
+fig_text(void *output_, int r, int g, int b, int size, unsigned depth, unsigned x, unsigned y, const char *text,hwloc_obj_t level)
 {
   FILE *output = output_;
   unsigned len = strlen(text);
diff --git a/utils/lstopo-native-svg.c b/utils/lstopo-native-svg.c
new file mode 100644
index 0000000..51879ef
--- /dev/null
+++ b/utils/lstopo-native-svg.c
@@ -0,0 +1,109 @@
+/*
+ * Copyright © 2009 CNRS
+ * Copyright © 2009-2012 Inria.  All rights reserved.
+ * Copyright © 2009-2010 Université Bordeaux 1
+ * Copyright © 2009-2011 Cisco Systems, Inc.  All rights reserved.
+ * See COPYING in top-level directory.
+ */
+
+#include <private/autogen/config.h>
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+
+#include "lstopo.h"
+#include "hwloc.h"
+
+struct native_svg_context
+{
+	FILE * fp;
+};
+
+/* Cairo methods */
+static void topo_native_svg_box(void *output, int r, int g, int b, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned width, unsigned y, unsigned height,hwloc_obj_t level)
+{
+	struct native_svg_context * cs = output;
+	char type[128];
+	hwloc_obj_type_snprintf(type, sizeof(type), level, 0);
+	if (type != NULL && level->logical_index >= 0)
+		fprintf(cs->fp,"\t<rect id='rect_%s_%d' class='%s' x='%d' y='%d' width='%d' height='%d' style='fill:rgb(%d,%d,%d);stoke-width:1;stroke:rgb(0,0,0)'/>\n",type,level->logical_index,type,x,y,width,height,r,g,b);
+	else
+		fprintf(cs->fp,"\t<rect x='%d' y='%d' width='%d' height='%d' style='fill:rgb(%d,%d,%d);stoke-width:1;stroke:rgb(0,0,0)'/>\n",x,y,width,height,r,g,b);
+}
+
+static void
+topo_native_svg_line(void *output, int r, int g, int b, unsigned depth __hwloc_attribute_unused, unsigned x1, unsigned y1, unsigned x2, unsigned y2)
+{
+	struct native_svg_context * cs = output;
+	fprintf(cs->fp,"\t<line x1='%d' y1='%d' x2='%d' y2='%d' style='stroke:rgb(%d,%d,%d);stroke-width:1;'/>\n",x1,y1,x2,y2,r,g,b);
+}
+
+static void
+topo_native_svg_text(void *output, int r, int g, int b, int size, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned y, const char *text,hwloc_obj_t level)
+{
+	struct native_svg_context * cs = output;
+	char type[128];
+	hwloc_obj_type_snprintf(type, sizeof(type), level, 0);
+	if (type != NULL && level->logical_index >= 0)
+		fprintf(cs->fp,"\t<text id='text_%s_%d' class='%s' x='%d' y='%d' fill='rgb(%d,%d,%d)' style='font-size:%dpx'>%s</text>\n",type,level->logical_index,type,x,y+size,r,g,b,size,text);
+	else
+		fprintf(cs->fp,"\t<text x='%d' y='%d' fill='rgb(%d,%d,%d)' style='font-size:%d'>%s</text>\n",x,y+size,r,g,b,size,text);
+}
+
+static void
+topo_native_svg_paint(struct draw_methods *methods, int logical, int legend, hwloc_topology_t topology,struct native_svg_context * cs)
+{
+	output_draw(methods, logical, legend, topology, cs);
+}
+
+static void null_declare_color (void *output __hwloc_attribute_unused, int r __hwloc_attribute_unused, int g __hwloc_attribute_unused, int b __hwloc_attribute_unused) {}
+
+/* SVG back-end */
+static void * native_svg_start(void *output, int width, int height)
+{
+	struct native_svg_context * cs = output;
+
+	fprintf(cs->fp,"%s","<?xml version='1.0' encoding='UTF-8'?>\n");
+	fprintf(cs->fp,"<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='%dpx' height='%dpx' viewBox='0 0 %dpx %dpx' version='1.1'>\n",width,height,width,height);
+	return output;
+}
+
+static struct draw_methods native_svg_draw_methods = {
+	native_svg_start,
+	null_declare_color,
+	topo_native_svg_box,
+	topo_native_svg_line,
+	topo_native_svg_text,
+};
+
+void print_svg_foot(struct native_svg_context cs)
+{
+	fprintf(cs.fp,"</svg>\n");
+}
+
+void output_native_svg(hwloc_topology_t topology, const char *filename, int logical, int legend, int verbose_mode __hwloc_attribute_unused)
+{
+	//vars
+	struct native_svg_context cs;
+
+	//open file
+	if (filename == NULL)
+		cs.fp = stdout;
+	else
+		cs.fp = fopen(filename,"w");
+	if (!cs.fp) {
+		perror(filename);
+		fprintf(stderr, "Failed to open %s for writing (%s)\n", filename, strerror(errno));
+		return;
+	}
+
+	//down
+	output_draw_start(&native_svg_draw_methods, logical, legend, topology, &cs);
+	topo_native_svg_paint(&native_svg_draw_methods, logical, legend, topology, &cs);
+	print_svg_foot(cs);
+
+	//close file
+	if (cs.fp != stdout)
+		fclose(cs.fp);
+}
diff --git a/utils/lstopo-text.c b/utils/lstopo-text.c
index be3f670..fdd5205 100644
--- a/utils/lstopo-text.c
+++ b/utils/lstopo-text.c
@@ -573,7 +573,7 @@ merge(struct display *disp, int x, int y, int or, int andnot, int r, int g, int
 
 /* Now we can implement the standard drawing helpers */
 static void
-text_box(void *output, int r, int g, int b, unsigned depth __hwloc_attribute_unused, unsigned x1, unsigned width, unsigned y1, unsigned height)
+text_box(void *output, int r, int g, int b, unsigned depth __hwloc_attribute_unused, unsigned x1, unsigned width, unsigned y1, unsigned height,hwloc_obj_t level)
 {
   struct display *disp = output;
   unsigned i, j;
@@ -661,7 +661,7 @@ text_line(void *output, int r __hwloc_attribute_unused, int g __hwloc_attribute_
 }
 
 static void
-text_text(void *output, int r, int g, int b, int size __hwloc_attribute_unused, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned y, const char *text)
+text_text(void *output, int r, int g, int b, int size __hwloc_attribute_unused, unsigned depth __hwloc_attribute_unused, unsigned x, unsigned y, const char *text,hwloc_obj_t level)
 {
   struct display *disp = output;
   x /= (gridsize/2);
diff --git a/utils/lstopo.c b/utils/lstopo.c
index ae8a793..795cfbb 100644
--- a/utils/lstopo.c
+++ b/utils/lstopo.c
@@ -231,7 +231,7 @@ void usage(const char *name, FILE *where)
 		  ", svg"
 #endif /* CAIRO_HAS_SVG_SURFACE */
 #endif /* LSTOPO_HAVE_GRAPHICS */
-		  ", xml, synthetic"
+		  ", xml, synthetic, native_svg"
 		  "\n");
   fprintf (where, "\nFormatting options:\n");
   fprintf (where, "  -l --logical          Display hwloc logical object indexes\n");
@@ -290,6 +290,7 @@ enum output_format {
   LSTOPO_OUTPUT_PDF,
   LSTOPO_OUTPUT_PS,
   LSTOPO_OUTPUT_SVG,
+  LSTOPO_OUTPUT_NATIVE_SVG,
   LSTOPO_OUTPUT_XML
 };
 
@@ -314,6 +315,8 @@ parse_output_format(const char *name, char *callname)
     return LSTOPO_OUTPUT_PS;
   else if (!strcasecmp(name, "svg"))
     return LSTOPO_OUTPUT_SVG;
+  else if (!strcasecmp(name, "native_svg"))
+    return LSTOPO_OUTPUT_NATIVE_SVG;
   else if (!strcasecmp(name, "xml"))
     return LSTOPO_OUTPUT_XML;
 
@@ -656,6 +659,9 @@ main (int argc, char *argv[])
       break;
 #endif /* CAIRO_HAS_SVG_SURFACE */
 #endif /* LSTOPO_HAVE_GRAPHICS */
+	case LSTOPO_OUTPUT_NATIVE_SVG:
+      output_native_svg(topology, filename, logical, legend, verbose_mode);
+      break;
     case LSTOPO_OUTPUT_XML:
       output_xml(topology, filename, logical, legend, verbose_mode);
       break;
diff --git a/utils/lstopo.h b/utils/lstopo.h
index 7bb76a9..7e46da5 100644
--- a/utils/lstopo.h
+++ b/utils/lstopo.h
@@ -25,9 +25,9 @@ extern output_method output_console, output_synthetic, output_text, output_x11,
 struct draw_methods {
   void* (*start) (void *output, int width, int height);
   void (*declare_color) (void *output, int r, int g, int b);
-  void (*box) (void *output, int r, int g, int b, unsigned depth, unsigned x, unsigned width, unsigned y, unsigned height);
+  void (*box) (void *output, int r, int g, int b, unsigned depth, unsigned x, unsigned width, unsigned y, unsigned height,hwloc_obj_t level);
   void (*line) (void *output, int r, int g, int b, unsigned depth, unsigned x1, unsigned y1, unsigned x2, unsigned y2);
-  void (*text) (void *output, int r, int g, int b, int size, unsigned depth, unsigned x, unsigned y, const char *text);
+  void (*text) (void *output, int r, int g, int b, int size, unsigned depth, unsigned x, unsigned y, const char *text,hwloc_obj_t level);
 };
 
 extern unsigned int gridsize, fontsize;
-- 
1.8.0

